
/* Drop Tables */

DROP TABLE IF EXISTS PUBLIC.CONTENIDOS;
DROP TABLE IF EXISTS PUBLIC.EJEMPLOS;
DROP TABLE IF EXISTS PUBLIC.EJERCICIOS;
DROP TABLE IF EXISTS PUBLIC.FUENTES;
DROP TABLE IF EXISTS PUBLIC.LECCIONES;
DROP TABLE IF EXISTS PUBLIC.MULTIMEDIA;
DROP TABLE IF EXISTS PUBLIC.TEMAS;
DROP TABLE IF EXISTS PUBLIC.USUARIO;



/* Drop Sequences */

DROP SEQUENCE IF EXISTS PUBLIC.CONTENIDOS_DESCRIP_CONTENIDOS_SEQ;
DROP SEQUENCE IF EXISTS PUBLIC.CONTENIDOS_ID_CONTENIDOS_SEQ;
DROP SEQUENCE IF EXISTS PUBLIC.EJEMPLOS_CONT_EJERCICIOS_SEQ;
DROP SEQUENCE IF EXISTS PUBLIC.EJEMPLOS_ID_EJEMPLOS_SEQ;
DROP SEQUENCE IF EXISTS PUBLIC.EJERCICIOS_ID_EJERCICIOS_SEQ;
DROP SEQUENCE IF EXISTS PUBLIC.FUENTES_ID_FUENTE_REFERENCIAS_SEQ;
DROP SEQUENCE IF EXISTS PUBLIC.LECCIONES_ID_LECCIONES_SEQ;
DROP SEQUENCE IF EXISTS PUBLIC.MULTIMEDIA_ID_MULTIMEDIA_SEQ;
DROP SEQUENCE IF EXISTS PUBLIC.TEMAS_ID_TEMAS_SEQ;
DROP SEQUENCE IF EXISTS PUBLIC.USUARIO_ID_USUARIO_SEQ;
DROP SEQUENCE IF EXISTS PUBLIC.USUARIO_LECCIONES_ID_USUARIOS_LECCIONES_SEQ;
DROP SEQUENCE IF EXISTS PUBLIC.USUARIO_TEMAS_ID_USUARIOS_TEMAS_SEQ;




/* Create Sequences */

CREATE SEQUENCE PUBLIC.EJEMPLOS_CONT_EJERCICIOS_SEQ INCREMENT 1 MINVALUE 1 MAXVALUE 9223372036854775807 START 1 CACHE 1;
CREATE SEQUENCE PUBLIC.USUARIO_LECCIONES_ID_USUARIOS_LECCIONES_SEQ INCREMENT 1 MINVALUE 1 MAXVALUE 9223372036854775807 START 1 CACHE 1;
CREATE SEQUENCE PUBLIC.USUARIO_TEMAS_ID_USUARIOS_TEMAS_SEQ INCREMENT 1 MINVALUE 1 MAXVALUE 9223372036854775807 START 1 CACHE 1;



/* Create Tables */

CREATE TABLE PUBLIC.CONTENIDOS
(
	-- ID de los contenidos
	ID_CONTENIDOS SERIAL NOT NULL,
	-- ID de las lecciones
	ID_LECCIONES INT NOT NULL,
	-- Descripción de los contenidos
	DESCRIP_CONTENIDOS SERIAL NOT NULL UNIQUE,
	-- ID de los ejemplos
	ID_EJEMPLOS INT NOT NULL,
	-- ID de los ejercicios
	ID_EJERCICIOS INT NOT NULL,
	-- If fuente bibliografica
	ID_FUENTE_REFERENCIAS INT NOT NULL,
	-- id del archivo multimedia
	ID_MULTIMEDIA INT NOT NULL,
	CONSTRAINT contenidos_pkey PRIMARY KEY (ID_CONTENIDOS)
) WITHOUT OIDS;


CREATE TABLE PUBLIC.EJEMPLOS
(
	-- ID de los ejemplos
	ID_EJEMPLOS SERIAL NOT NULL,
	-- Nombre de los ejemplos
	NB_EJEMPLOS CHAR(100) NOT NULL,
	-- Contenido de los ejercicios
	CONT_EJERCICIOS TEXT NOT NULL UNIQUE,
	CONSTRAINT ejemplos_pkey PRIMARY KEY (ID_EJEMPLOS)
) WITHOUT OIDS;


CREATE TABLE PUBLIC.EJERCICIOS
(
	-- ID de los ejercicios
	ID_EJERCICIOS SERIAL NOT NULL,
	-- Nombre de los ejercicios
	NB_EJERCICIOS CHAR(100) NOT NULL,
	-- Descripción de los ejercicios
	DES_EJERCICIOS TEXT,
	-- Contenido de los ejercicios
	CONT_EJERCICIOS TEXT NOT NULL UNIQUE,
	CONSTRAINT ejercicios_pkey PRIMARY KEY (ID_EJERCICIOS)
) WITHOUT OIDS;


CREATE TABLE PUBLIC.FUENTES
(
	-- If fuente bibliografica
	ID_FUENTE_REFERENCIAS SERIAL NOT NULL,
	-- Fuente  referencias
	FUENTE_REFERENCIAS TEXT NOT NULL UNIQUE,
	CONSTRAINT fuentes_pkey PRIMARY KEY (ID_FUENTE_REFERENCIAS)
) WITHOUT OIDS;


CREATE TABLE PUBLIC.LECCIONES
(
	-- ID de las lecciones
	ID_LECCIONES SERIAL NOT NULL,
	-- ID de los temas
	ID_TEMAS INT NOT NULL,
	-- Nombre de las lecciones
	NB_LECCIONES CHAR(100) NOT NULL UNIQUE,
	CONSTRAINT lecciones_pkey PRIMARY KEY (ID_LECCIONES)
) WITHOUT OIDS;


CREATE TABLE PUBLIC.MULTIMEDIA
(
	-- id del archivo multimedia
	ID_MULTIMEDIA SERIAL NOT NULL,
	-- URL del archivo 
	URL_MULTIMEDIA TEXT NOT NULL UNIQUE,
	CONSTRAINT multimedia_pkey PRIMARY KEY (ID_MULTIMEDIA)
) WITHOUT OIDS;


CREATE TABLE PUBLIC.TEMAS
(
	-- ID de los temas
	ID_TEMAS SERIAL NOT NULL,
	-- Nombre de los temas
	NB_TEMAS CHAR(100) NOT NULL UNIQUE,
	-- Descripción de los temas
	DESCRIP_TEMAS TEXT NOT NULL,
	CONSTRAINT temas_pkey PRIMARY KEY (ID_TEMAS)
) WITHOUT OIDS;


CREATE TABLE PUBLIC.USUARIO
(
	ID_USUARIO SERIAL NOT NULL,
	NOMBRE VARCHAR(50) NOT NULL,
	APELLIDO VARCHAR(50) NOT NULL,
	EMAIL VARCHAR(100) NOT NULL,
	USERNAME VARCHAR(128) NOT NULL UNIQUE,
	PASSWORD VARCHAR(128) NOT NULL UNIQUE,
	PERFIL VARCHAR(10) NOT NULL,
	CREATED_AT TIMESTAMP DEFAULT now(),
	LAST_LOGIN TIMESTAMP,
	CONSTRAINT usuario_pkey PRIMARY KEY (ID_USUARIO)
) WITHOUT OIDS;



/* Create Foreign Keys */

ALTER TABLE PUBLIC.CONTENIDOS
	ADD FOREIGN KEY (ID_EJEMPLOS)
	REFERENCES PUBLIC.EJEMPLOS (ID_EJEMPLOS)
	ON UPDATE RESTRICT
	ON DELETE RESTRICT
;


ALTER TABLE PUBLIC.CONTENIDOS
	ADD FOREIGN KEY (ID_EJERCICIOS)
	REFERENCES PUBLIC.EJERCICIOS (ID_EJERCICIOS)
	ON UPDATE RESTRICT
	ON DELETE RESTRICT
;


ALTER TABLE PUBLIC.CONTENIDOS
	ADD FOREIGN KEY (ID_FUENTE_REFERENCIAS)
	REFERENCES PUBLIC.FUENTES (ID_FUENTE_REFERENCIAS)
	ON UPDATE RESTRICT
	ON DELETE RESTRICT
;


ALTER TABLE PUBLIC.CONTENIDOS
	ADD CONSTRAINT CONTENIDOS_ID_LECCIONES_FKEY FOREIGN KEY (ID_LECCIONES)
	REFERENCES PUBLIC.LECCIONES (ID_LECCIONES)
	ON UPDATE RESTRICT
	ON DELETE RESTRICT
;


ALTER TABLE PUBLIC.CONTENIDOS
	ADD FOREIGN KEY (ID_MULTIMEDIA)
	REFERENCES PUBLIC.MULTIMEDIA (ID_MULTIMEDIA)
	ON UPDATE RESTRICT
	ON DELETE RESTRICT
;


ALTER TABLE PUBLIC.LECCIONES
	ADD CONSTRAINT LECCIONES_ID_TEMAS_FKEY FOREIGN KEY (ID_TEMAS)
	REFERENCES PUBLIC.TEMAS (ID_TEMAS)
	ON UPDATE RESTRICT
	ON DELETE RESTRICT
;



/* Comments */

COMMENT ON COLUMN PUBLIC.CONTENIDOS.ID_CONTENIDOS IS 'ID de los contenidos';
COMMENT ON COLUMN PUBLIC.CONTENIDOS.ID_LECCIONES IS 'ID de las lecciones';
COMMENT ON COLUMN PUBLIC.CONTENIDOS.DESCRIP_CONTENIDOS IS 'Descripción de los contenidos';
COMMENT ON COLUMN PUBLIC.CONTENIDOS.ID_EJEMPLOS IS 'ID de los ejemplos';
COMMENT ON COLUMN PUBLIC.CONTENIDOS.ID_EJERCICIOS IS 'ID de los ejercicios';
COMMENT ON COLUMN PUBLIC.CONTENIDOS.ID_FUENTE_REFERENCIAS IS 'If fuente bibliografica';
COMMENT ON COLUMN PUBLIC.CONTENIDOS.ID_MULTIMEDIA IS 'id del archivo multimedia';
COMMENT ON COLUMN PUBLIC.EJEMPLOS.ID_EJEMPLOS IS 'ID de los ejemplos';
COMMENT ON COLUMN PUBLIC.EJEMPLOS.NB_EJEMPLOS IS 'Nombre de los ejemplos';
COMMENT ON COLUMN PUBLIC.EJEMPLOS.CONT_EJERCICIOS IS 'Contenido de los ejercicios';
COMMENT ON COLUMN PUBLIC.EJERCICIOS.ID_EJERCICIOS IS 'ID de los ejercicios';
COMMENT ON COLUMN PUBLIC.EJERCICIOS.NB_EJERCICIOS IS 'Nombre de los ejercicios';
COMMENT ON COLUMN PUBLIC.EJERCICIOS.DES_EJERCICIOS IS 'Descripción de los ejercicios';
COMMENT ON COLUMN PUBLIC.EJERCICIOS.CONT_EJERCICIOS IS 'Contenido de los ejercicios';
COMMENT ON COLUMN PUBLIC.FUENTES.ID_FUENTE_REFERENCIAS IS 'If fuente bibliografica';
COMMENT ON COLUMN PUBLIC.FUENTES.FUENTE_REFERENCIAS IS 'Fuente  referencias';
COMMENT ON COLUMN PUBLIC.LECCIONES.ID_LECCIONES IS 'ID de las lecciones';
COMMENT ON COLUMN PUBLIC.LECCIONES.ID_TEMAS IS 'ID de los temas';
COMMENT ON COLUMN PUBLIC.LECCIONES.NB_LECCIONES IS 'Nombre de las lecciones';
COMMENT ON COLUMN PUBLIC.MULTIMEDIA.ID_MULTIMEDIA IS 'id del archivo multimedia';
COMMENT ON COLUMN PUBLIC.MULTIMEDIA.URL_MULTIMEDIA IS 'URL del archivo ';
COMMENT ON COLUMN PUBLIC.TEMAS.ID_TEMAS IS 'ID de los temas';
COMMENT ON COLUMN PUBLIC.TEMAS.NB_TEMAS IS 'Nombre de los temas';
COMMENT ON COLUMN PUBLIC.TEMAS.DESCRIP_TEMAS IS 'Descripción de los temas';



